<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®ÙˆÙ„ÙŠ</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4338ca">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/wTqH1VNR/genius-math-icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #f4f7fe; padding-bottom: 90px; overflow-x: hidden; }
        .page { display: none; }
        .active-page { display: block; }
        .nav-active { color: #4f46e5 !important; font-weight: bold; }
        #auth-overlay { position: fixed; inset: 0; background: #4338ca; z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        #sidebar { position: fixed; top: 0; right: -100%; width: 80%; max-width: 300px; height: 100%; background: white; z-index: 1001; transition: 0.3s; box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
        #sidebar.open { right: 0; }
        #sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; }
        .option-btn { border: 2px solid #e5e7eb; transition: 0.2s; text-align: right; width: 100%; padding: 12px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; background: #f9fafb; }
        .option-btn.selected { border-color: #4f46e5; background-color: #eef2ff; }
        .correct { background-color: #10b981 !important; color: white; border-color: #059669; }
        .wrong { background-color: #ef4444 !important; color: white; border-color: #dc2626; }
        
        /* Notifications Styles */
        #notif-dropdown { position: absolute; top: 60px; left: 10px; width: 280px; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); z-index: 100; display: none; max-height: 400px; overflow-y: auto; }
        .notif-item { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 11px; cursor: pointer; color: #1e293b; line-height: 1.5; }
        .notif-unread { background: #eef2ff !important; border-right: 5px solid #4f46e5 !important; font-weight: bold !important; color: #000000 !important; }
        .notif-read { background: #ffffff !important; border-right: 5px solid #e5e7eb !important; opacity: 0.9; color: #4b5563 !important; }
        .unread-dot { width: 10px; height: 10px; background: #ef4444; border-radius: 50%; position: absolute; top: -2px; right: -2px; border: 2px solid white; }
        
        #install-container { background: linear-gradient(135deg, #4f46e5 0%, #3b82f6 100%); transition: transform 0.3s ease; }
        #install-container:active { transform: scale(0.95); }

        /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø·Ø± --- */
        .post-text, .comment-text, .question-text, #daily-display-text, .reply-text {
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
        }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="bg-white w-full max-w-sm rounded-[30px] p-8 shadow-2xl text-center">
        <h2 class="text-2xl font-bold text-indigo-700 mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h2>
        <p class="text-gray-500 text-xs mb-6">Ù…Ù†ØµØ© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®ÙˆÙ„ÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
        <div class="space-y-4">
            <input id="user-fullname" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ø¹Ø±Ø¨ÙŠ)" class="w-full border rounded-2xl p-3 text-sm outline-none text-center">
            <input id="user-id" type="text" placeholder="Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… (English)" class="w-full border rounded-2xl p-3 text-sm outline-none text-center" oninput="this.value = this.value.replace(/[^a-zA-Z0-9]/g, '').toLowerCase()">
            <input id="user-whatsapp" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨" class="w-full border rounded-2xl p-3 text-sm outline-none text-center">
            <button onclick="handleAuth()" class="w-full bg-indigo-600 text-white py-3 rounded-2xl font-bold">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
        </div>
        <p id="auth-msg" class="text-red-500 text-[10px] mt-4 font-bold"></p>
    </div>
</div>

<div id="sidebar-overlay" onclick="toggleSidebar()"></div>
<div id="sidebar" class="p-6">
    <div class="flex justify-between items-center mb-8">
        <h2 class="font-bold text-xl text-indigo-700">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h2>
        <button onclick="toggleSidebar()" class="text-2xl">&times;</button>
    </div>
    <div class="space-y-4">
        <button onclick="showPage('ask-me')" class="w-full text-right p-4 rounded-xl bg-blue-50 text-blue-700 font-bold flex items-center gap-3"><i class="fas fa-question-circle"></i> Ø§Ø³Ø£Ù„Ù†ÙŠ</button>
        <button onclick="showEducationPage('quizzes')" class="w-full text-right p-4 rounded-xl bg-indigo-50 text-indigo-700 font-bold flex items-center gap-3"><i class="fas fa-tasks"></i> Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
        <button onclick="showEducationPage('videos')" class="w-full text-right p-4 rounded-xl bg-red-50 text-red-700 font-bold flex items-center gap-3"><i class="fab fa-youtube"></i> Ø§Ù„Ø´Ø±ÙˆØ­Ø§Øª</button>
        <button onclick="showEducationPage('books')" class="w-full text-right p-4 rounded-xl bg-green-50 text-green-700 font-bold flex items-center gap-3"><i class="fas fa-file-pdf"></i> Ø§Ù„Ù…Ù„Ø§Ø²Ù…</button>
        <button onclick="showPage('achievements')" class="w-full text-right p-4 rounded-xl bg-orange-50 text-orange-700 font-bold flex items-center gap-3"><i class="fas fa-star"></i> Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙŠ</button>
    </div>
    <div id="install-container" class="p-4 mt-8 rounded-2xl shadow-lg text-white">
        <button id="install-btn" class="w-full text-right flex items-center gap-3 font-bold text-sm">
            <i class="fas fa-download animate-bounce"></i> <span> ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ </span>
        </button>
        <div class="mt-2 pt-2 border-t border-white/20 text-[10px] flex justify-between">
            <span>ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
            <span id="install-count-public">0</span>
        </div>
    </div>
</div>

<header class="bg-indigo-700 text-white p-5 shadow-xl sticky top-0 z-50 rounded-b-[30px] flex justify-between items-center">
    <button onclick="toggleSidebar()" class="text-xl px-2"><i class="fas fa-bars"></i></button>
    <h1 onclick="handleSecretClick()" class="text-xl font-bold cursor-pointer select-none">Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h1>
    <div class="relative">
        <button onclick="toggleNotifs()" class="text-xl pt-1"><i class="fas fa-bell"></i></button>
        <div id="notif-badge" class="unread-dot hidden"></div>
        <div id="notif-dropdown">
            <div class="p-3 border-b font-bold text-xs text-indigo-700">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
            <div id="notif-list"></div>
        </div>
    </div>
</header>

<main class="p-4 max-w-md mx-auto">
    <section id="admin-panel" class="hidden bg-white p-6 rounded-[30px] mb-8 border-2 border-indigo-600 shadow-2xl overflow-y-auto max-h-[85vh]">
        <div class="bg-indigo-50 p-4 rounded-2xl border border-indigo-100 mb-6 flex justify-between items-center">
            <span class="text-xs font-bold text-indigo-800">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</span>
            <span id="admin-install-count" class="text-xl font-black text-indigo-600">0</span>
        </div>
        <h3 class="font-bold text-indigo-700 mb-4 text-center border-b pb-2">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
        <select id="admin-select-sec" class="w-full p-2 mb-4 border rounded-xl text-xs" onchange="switchAdminView()">
            <option value="posts">Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØ§Ù„Ø£ÙˆØ§Ø¦Ù„</option>
            <option value="daily">Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ ğŸ’¡</option>
            <option value="quiz">Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø±</option>
            <option value="inbox">Ø·Ù„Ø¨Ø§Øª Ø§Ø³Ø£Ù„Ù†ÙŠ</option>
            <option value="results">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</option>
            <option value="content">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙˆÙ…Ù„Ø§Ø²Ù…</option>
        </select>

        <div id="adm-posts" class="adm-section space-y-3">
            <textarea id="post-input" class="w-full border rounded-xl p-2 text-xs" placeholder="Ø§ÙƒØªØ¨ Ø¨ÙˆØ³Øª Ø¬Ø¯ÙŠØ¯..."></textarea>
            <input id="post-img" type="text" class="w-full border rounded-xl p-2 text-xs" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©">
            <button onclick="publishPost()" class="w-full bg-indigo-600 text-white py-2 rounded-xl text-xs font-bold">Ù†Ø´Ø±</button>
            <hr>
            <input id="top-name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ØªÙÙˆÙ‚" class="w-full border rounded-xl p-2 text-xs">
            <input id="top-img" type="text" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨" class="w-full border rounded-xl p-2 text-xs">
            <button onclick="addTopStudent()" class="w-full bg-yellow-500 text-white py-2 rounded-xl text-xs font-bold">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø£ÙˆØ§Ø¦Ù„</button>
        </div>

        <div id="adm-daily" class="adm-section hidden space-y-3">
            <textarea id="daily-q-text" class="w-full border rounded-xl p-2 text-xs" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ..."></textarea>
            <input id="daily-q-img" type="text" class="w-full border rounded-xl p-2 text-xs" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <div class="grid grid-cols-2 gap-2">
                <input id="daily-opt-0" type="text" placeholder="Ø®ÙŠØ§Ø± 1" class="border p-2 rounded-lg text-xs">
                <input id="daily-opt-1" type="text" placeholder="Ø®ÙŠØ§Ø± 2" class="border p-2 rounded-lg text-xs">
                <input id="daily-opt-2" type="text" placeholder="Ø®ÙŠØ§Ø± 3" class="border p-2 rounded-lg text-xs">
                <input id="daily-opt-3" type="text" placeholder="Ø®ÙŠØ§Ø± 4" class="border p-2 rounded-lg text-xs">
            </div>
            <select id="daily-q-correct" class="w-full p-2 border rounded-xl bg-green-50 text-xs">
                <option value="0">Ø®ÙŠØ§Ø± 1 ØµØ­</option><option value="1">Ø®ÙŠØ§Ø± 2 ØµØ­</option>
                <option value="2">Ø®ÙŠØ§Ø± 3 ØµØ­</option><option value="3">Ø®ÙŠØ§Ø± 4 ØµØ­</option>
            </select>
            <button onclick="publishDailyChallenge()" class="w-full bg-indigo-600 text-white py-2 rounded-xl font-bold text-xs">Ù†Ø´Ø± Ø§Ù„ØªØ­Ø¯ÙŠ</button>
        </div>

        <div id="adm-inbox" class="adm-section hidden space-y-3"><div id="admin-questions-list" class="space-y-3"></div></div>
        <div id="adm-results" class="adm-section hidden space-y-3"><div id="admin-results-list" class="space-y-2"></div></div>

        <div id="adm-quiz" class="adm-section hidden space-y-3">
            <input id="q-title" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±" class="w-full border rounded-xl p-2 text-xs">
            <div class="flex gap-1">
                <select id="q-grade" class="flex-1 p-2 border rounded-xl text-[10px] stage-select"></select>
                <select id="q-term" class="flex-1 p-2 border rounded-xl text-[10px]"><option>ØªØ±Ù… Ø£ÙˆÙ„</option><option>ØªØ±Ù… Ø«Ø§Ù†ÙŠ</option></select>
            </div>
            <div id="questions-builder" class="space-y-4"></div>
            <button onclick="addQuestionUI()" class="w-full bg-gray-100 py-2 rounded-xl text-[10px]">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
            <button onclick="saveQuiz()" class="w-full bg-indigo-600 text-white py-2 rounded-xl font-bold">Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        </div>

        <div id="adm-content" class="adm-section hidden space-y-3">
            <select id="cont-type" class="w-full p-2 border rounded-xl text-xs"><option value="video">ÙÙŠØ¯ÙŠÙˆ</option><option value="book">Ù…Ù„Ø²Ù…Ø©</option></select>
            <input id="cont-title" type="text" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="w-full border rounded-xl p-2 text-xs">
            <input id="cont-link" type="text" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·" class="w-full border rounded-xl p-2 text-xs">
            <select id="cont-grade" class="w-full p-2 border rounded-xl text-xs stage-select"></select>
            <select id="cont-term" class="w-full p-2 border rounded-xl text-xs"><option>ØªØ±Ù… Ø£ÙˆÙ„</option><option>ØªØ±Ù… Ø«Ø§Ù†ÙŠ</option></select>
            <button onclick="addContent()" class="w-full bg-indigo-600 text-white py-2 rounded-xl font-bold">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
    </section>

    <section id="posts" class="page active-page"><div id="posts-feed" class="space-y-6"></div></section>

    <section id="achievements" class="page">
        <div id="daily-challenge-box" class="hidden bg-indigo-700 rounded-[30px] p-6 mb-6 text-white shadow-xl relative">
            <div class="flex justify-between items-center mb-4">
                <span class="text-[10px] bg-white/20 px-3 py-1 rounded-full">ğŸ”¥ ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…</span>
            </div>
            <p id="daily-display-text" class="text-sm font-bold mb-4"></p>
            <div id="daily-display-img" class="mb-4"></div>
            <div id="daily-options-grid" class="grid grid-cols-1 gap-2"></div>
        </div>

        <div class="bg-white rounded-[30px] p-8 shadow-xl text-center mb-6 border">
            <i class="fas fa-trophy text-4xl text-yellow-500 mb-4"></i>
            <h2 class="text-xl font-bold mb-4" id="dash-name">Ù„ÙˆØ­Ø© Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙŠ</h2>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-indigo-50 p-4 rounded-2xl"><p class="text-[10px] text-gray-500">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</p><p id="dash-tests-count" class="text-2xl font-bold text-indigo-700">0</p></div>
                <div class="bg-green-50 p-4 rounded-2xl"><p class="text-[10px] text-gray-500">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p><p id="dash-avg" class="text-2xl font-bold text-green-600">0%</p></div>
            </div>
        </div>
        <div id="tests-history" class="space-y-3"></div>
    </section>

    <section id="edu-page" class="page">
        <div class="flex gap-2 mb-4">
            <select id="filter-grade" class="flex-1 p-2 bg-white rounded-xl shadow-sm text-xs stage-select" onchange="renderEducation()"></select>
            <select id="filter-term" class="flex-1 p-2 bg-white rounded-xl shadow-sm text-xs" onchange="renderEducation()"><option>ØªØ±Ù… Ø£ÙˆÙ„</option><option>ØªØ±Ù… Ø«Ø§Ù†ÙŠ</option></select>
        </div>
        <div id="edu-list" class="space-y-4"></div>
    </section>

    <section id="ask-me" class="page">
        <div class="bg-white rounded-[30px] p-6 shadow-sm border mb-6 text-center">
            <h2 class="font-bold text-indigo-700 mb-4">Ø§Ø³Ø£Ù„Ù†ÙŠ ğŸ§ </h2>
            <textarea id="ask-text" class="w-full border p-3 rounded-2xl text-xs outline-none mb-3" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..."></textarea>
            <input id="ask-img-inp" type="text" class="w-full border p-3 rounded-2xl text-xs outline-none mb-3" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <button onclick="submitQuestion()" class="w-full bg-indigo-600 text-white py-3 rounded-2xl font-bold">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
        <div id="my-questions" class="space-y-4"></div>
    </section>

    <section id="top-students" class="page"><div id="students-list" class="grid grid-cols-2 gap-4"></div></section>
    
    <section id="quiz-view" class="page">
        <div class="bg-white rounded-[30px] p-6 shadow-xl border">
            <h2 id="active-q-title" class="text-center font-bold text-indigo-700 mb-6"></h2>
            <div id="quiz-questions-container" class="space-y-10"></div>
            <button id="submit-quiz-btn" onclick="finishQuiz()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold mt-10">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>
            <div id="quiz-result" class="hidden mt-8 text-center pt-6 border-t">
                <div id="score-circle" class="w-20 h-20 rounded-full bg-indigo-600 text-white flex items-center justify-center mx-auto text-2xl font-bold mb-6"></div>
                <button onclick="shareResult()" class="bg-green-500 text-white px-8 py-3 rounded-2xl font-bold"><i class="fab fa-whatsapp ml-2"></i> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
            </div>
        </div>
    </section>

    <section id="contact" class="page">
        <div class="bg-white rounded-[40px] p-8 shadow-xl border text-center">
            <div id="profile-pic-disp" class="w-24 h-24 mx-auto mb-4 rounded-full border-4 border-white shadow overflow-hidden flex items-center justify-center"></div>
            <h2 id="prof-name-disp" class="text-xl font-bold text-indigo-700">Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®ÙˆÙ„ÙŠ</h2>
            <div class="space-y-3 mt-6">
                <a id="prof-wa-link" href="#" target="_blank" class="block bg-green-500 text-white p-3 rounded-2xl font-bold">ÙˆØ§ØªØ³Ø§Ø¨</a>
                <a id="prof-fb-link" href="#" target="_blank" class="block bg-blue-600 text-white p-3 rounded-2xl font-bold">ÙÙŠØ³Ø¨ÙˆÙƒ</a>
            </div>
        </div>
    </section>
</main>

<nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-3 z-50 rounded-t-[30px] shadow-2xl">
    <button onclick="showPage('posts')" id="btn-posts" class="flex flex-col items-center text-gray-400 nav-active"><i class="fas fa-home"></i><span class="text-[10px] mt-1">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
    <button onclick="showPage('top-students')" id="btn-top-students" class="flex flex-col items-center text-gray-400"><i class="fas fa-medal"></i><span class="text-[10px] mt-1">Ø§Ù„Ø£ÙˆØ§Ø¦Ù„</span></button>
    <button onclick="showPage('contact')" id="btn-contact" class="flex flex-col items-center text-gray-400"><i class="fas fa-user-tie"></i><span class="text-[10px] mt-1">Ø§Ù„Ø£Ø³ØªØ§Ø°</span></button>
</nav>

<script>
const firebaseConfig = { databaseURL: "https://genius-math-44207-default-rtdb.firebaseio.com/" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const stages = ["Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ", "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ", "Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"];
document.querySelectorAll('.stage-select').forEach(sel => { stages.forEach(s => sel.innerHTML += `<option>${s}</option>`); });

let isAdmin = false, sCount = 0, eduType = 'quizzes', activeQuizData = null, userAnswers = {};
let currentUser = JSON.parse(localStorage.getItem('math_user')) || null;

if(currentUser) { 
    document.getElementById('auth-overlay').style.display = 'none'; 
    listenToNotifs(); 
    renderAchievements(); 
    listenToDailyChallenge(); 
}

function handleAuth() {
    const name = document.getElementById('user-fullname').value, uid = document.getElementById('user-id').value, wa = document.getElementById('user-whatsapp').value;
    if(!name || !uid || !wa) return alert("Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    const userData = { fullname: name, username: uid, whatsapp: wa };
    db.ref('users/' + uid).set(userData).then(() => { localStorage.setItem('math_user', JSON.stringify(userData)); location.reload(); });
}

function showPage(id) { 
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
    document.getElementById(id).classList.add('active-page');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active'));
    if(document.getElementById('btn-'+id)) document.getElementById('btn-'+id).classList.add('nav-active');
    if(document.getElementById('sidebar').classList.contains('open')) toggleSidebar();
}

function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('open');
    const over = document.getElementById('sidebar-overlay');
    over.style.display = over.style.display === 'block' ? 'none' : 'block';
}

function showEducationPage(type) { eduType = type; toggleSidebar(); showPage('edu-page'); renderEducation(); }

function handleSecretClick() { sCount++; if(sCount === 5) { if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") === "2025") { isAdmin = true; document.getElementById('admin-panel').classList.remove('hidden'); renderAdminInbox(); renderAdminResults(); } sCount = 0; } }

function switchAdminView() {
    const val = document.getElementById('admin-select-sec').value;
    document.querySelectorAll('.adm-section').forEach(s => s.classList.add('hidden'));
    document.getElementById('adm-' + val).classList.remove('hidden');
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
db.ref('posts').on('value', snap => {
    const feed = document.getElementById('posts-feed'); feed.innerHTML = "";
    const data = snap.val(); if(!data) return;
    Object.keys(data).reverse().forEach(pid => {
        const p = data[pid]; let total = 0; let coms = "";
        if(p.comments) {
            Object.keys(p.comments).forEach(cid => {
                const c = p.comments[cid]; total++;
                let reps = "";
                if(c.replies) Object.keys(c.replies).forEach(rid => { total++; reps += `<div class="bg-white p-2 rounded-lg text-[9px] mt-1 mr-4 border reply-text"><b>${c.replies[rid].name}:</b> ${c.replies[rid].text}</div>`; });
                coms += `<div class="bg-gray-50 p-2 rounded-xl text-[10px] mb-2 border-r-2 border-indigo-200">
                    <div class="flex justify-between"><b>${c.name}:</b> <span class="text-[8px] text-gray-400">${c.time||''}</span></div>
                    <div class="comment-text">${c.text}</div>
                    <button onclick="document.getElementById('rb-${cid}').classList.toggle('hidden')" class="text-indigo-500 block text-[9px] mt-1">Ø±Ø¯</button>
                    <div id="rb-${cid}" class="hidden flex mt-1"><input id="ri-${cid}" class="flex-1 border rounded p-1 text-[8px]"><button onclick="sendReply('${pid}','${cid}')" class="bg-indigo-500 text-white px-2 rounded">âœ”</button></div>
                    ${reps}
                </div>`;
            });
        }
        feed.innerHTML += `<div class="bg-white rounded-[25px] shadow-sm border overflow-hidden">
            ${p.img ? `<img src="${p.img}" class="w-full max-h-80 object-contain bg-gray-50">` : ""}
            <div class="p-4"><p class="text-sm font-bold post-text">${p.text}</p><div class="flex justify-between items-center mt-3 pt-2 border-t">
                <button onclick="toggleLike('${pid}')" class="text-red-500 text-xs font-bold"><i class="fas fa-heart"></i> ${p.likes||0}</button>
                <button onclick="document.getElementById('csec-${pid}').classList.toggle('hidden')" class="text-indigo-600 text-xs font-bold">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (${total})</button>
            </div><div id="csec-${pid}" class="hidden mt-4">${coms}<div class="flex gap-1 mt-2"><input id="ci-${pid}" placeholder="ØªØ¹Ù„ÙŠÙ‚..." class="flex-1 bg-gray-50 p-2 rounded-xl text-[10px]"><button onclick="sendCom('${pid}')" class="bg-indigo-600 text-white px-3 rounded-xl">âœ”</button></div></div></div></div>`;
    });
});

function toggleLike(pid) { const r = db.ref(`posts/${pid}/likedBy/${currentUser.username}`); r.once('value', s => { if(s.exists()) { r.remove(); db.ref(`posts/${pid}/likes`).transaction(c => c-1); } else { r.set(true); db.ref(`posts/${pid}/likes`).transaction(c => (c||0)+1); } }); }
function sendCom(pid) { const t = document.getElementById('ci-'+pid).value; if(t) { db.ref(`posts/${pid}/comments`).push({ name: isAdmin?"Ø§Ù„Ø£Ø¯Ù…Ù†":currentUser.fullname, text: t, time: getFullDateTime(), uid: currentUser.username }); document.getElementById('ci-'+pid).value=""; } }
function sendReply(pid, cid) { const t = document.getElementById('ri-'+cid).value; if(t) { db.ref(`posts/${pid}/comments/${cid}/replies`).push({ name: isAdmin?"Ø§Ù„Ø£Ø¯Ù…Ù†":currentUser.fullname, text: t, time: getFullDateTime(), uid: currentUser.username }); document.getElementById('ri-'+cid).value=""; } }

// Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…
function publishDailyChallenge() {
    const data = {
        text: document.getElementById('daily-q-text').value,
        img: document.getElementById('daily-q-img').value,
        options: [document.getElementById('daily-opt-0').value, document.getElementById('daily-opt-1').value, document.getElementById('daily-opt-2').value, document.getElementById('daily-opt-3').value],
        correct: parseInt(document.getElementById('daily-q-correct').value),
        startTime: Date.now()
    };
    db.ref('daily_challenge').set(data).then(() => { sendGlobalNotif("ğŸ§  ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù†ØªØ¸Ø§Ø±Ùƒ ÙÙŠ ØµÙØ­Ø© Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙŠ!"); alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±"); });
}

function listenToDailyChallenge() {
    db.ref('daily_challenge').on('value', snap => {
        const box = document.getElementById('daily-challenge-box'), data = snap.val();
        if(!data || (Date.now() - data.startTime) / (1000 * 60 * 60) >= 24) { box.classList.add('hidden'); return; }
        db.ref(`daily_challenge/responses/${currentUser.username}`).once('value', s => {
            if(s.exists()) box.classList.add('hidden');
            else { box.classList.remove('hidden'); renderDailyUI(data); }
        });
    });
}

function renderDailyUI(data) {
    document.getElementById('daily-display-text').innerText = data.text;
    document.getElementById('daily-display-img').innerHTML = data.img ? `<img src="${data.img}" class="w-full rounded-xl">` : "";
    const grid = document.getElementById('daily-options-grid'); grid.innerHTML = "";
    data.options.forEach((opt, i) => { if(opt) grid.innerHTML += `<button onclick="answerDaily(${i})" class="bg-white/10 hover:bg-white/20 border border-white/30 p-3 rounded-xl text-xs text-right">${opt}</button>`; });
}

function answerDaily(index) {
    db.ref('daily_challenge').once('value', snap => {
        if(index === snap.val().correct) {
            db.ref('results').push({ uid: currentUser.username, userName: currentUser.fullname, quizTitle: "ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ… âœ…", percent: 100, time: getFullDateTime() });
            alert("Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!");
        } else alert("Ø®Ø§Ø·Ø¦Ø©!");
        db.ref(`daily_challenge/responses/${currentUser.username}`).set({ done: true });
    });
}

// Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª
function listenToNotifs() {
    db.ref('notifications/' + currentUser.username).on('value', snap => {
        const list = document.getElementById('notif-list'), data = snap.val(); list.innerHTML = ""; if(!data) { document.getElementById('notif-badge').classList.add('hidden'); return; }
        let unread = 0;
        Object.keys(data).reverse().forEach(id => {
            if(!data[id].read) unread++;
            list.innerHTML += `<div class="notif-item ${data[id].read?'notif-read':'notif-unread'}" onclick="handleNotifClick('${id}')">${data[id].msg}<br><span class="text-[8px] opacity-70">${data[id].time}</span></div>`;
        });
        unread > 0 ? document.getElementById('notif-badge').classList.remove('hidden') : document.getElementById('notif-badge').classList.add('hidden');
    });
}

let notifTargetPage = null;

function handleNotifClick(id) {
    const drop = document.getElementById('notif-dropdown');
    drop.style.display = 'none';

    db.ref(`notifications/${currentUser.username}/${id}`).once('value', snap => {
        if (!snap.exists()) return;

        const notif = snap.val();

        // ØªØ¹Ù„ÙŠÙ… ÙƒÙ…Ù‚Ø±ÙˆØ¡
        db.ref(`notifications/${currentUser.username}/${id}`).update({ read: true });

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙØ­Ø© ÙÙ‚Ø·
        if (notif.msg.includes('ØªØ­Ø¯ÙŠ')) notifTargetPage = 'achievements';
        else if (notif.msg.includes('Ù…Ù†Ø´ÙˆØ±')) notifTargetPage = 'posts';
        else if (notif.msg.includes('Ø³Ø¤Ø§Ù„Ùƒ')) notifTargetPage = 'ask-me';
        else if (notif.msg.includes('Ø§Ø®ØªØ¨Ø§Ø±')) notifTargetPage = 'edu-page';
        else notifTargetPage = null;
    });

    // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù€ callback
    setTimeout(() => {
        if (notifTargetPage) {
            if (notifTargetPage === 'edu-page') showEducationPage('quizzes');
            else showPage(notifTargetPage);
        }
    }, 150);
}
function toggleNotifs() { const d = document.getElementById('notif-dropdown'); d.style.display = d.style.display === 'block' ? 'none' : 'block'; }
function sendGlobalNotif(data) {
    db.ref('users').once('value', s => {
        s.forEach(u => {
            db.ref('notifications/' + u.key).push({
                msg: data.msg,
                type: data.type || "general",
                time: getFullDateTime(),
                read: false
            });
        });
    });
}

function submitQuestion() {
    const t = document.getElementById('ask-text').value, i = document.getElementById('ask-img-inp').value;
    if(t||i) db.ref('tickets').push({ uid: currentUser.username, name: currentUser.fullname, text: t, img: i, status: 'Ù…ÙØªÙˆØ­', time: getFullDateTime() });
}

db.ref('tickets').on('value', snap => {
    if(!currentUser) return;
    const div = document.getElementById('my-questions'); div.innerHTML = "";
    snap.forEach(c => { if(c.val().uid === currentUser.username) div.innerHTML += `<div class="bg-white p-4 rounded-2xl border mb-3"><p class="text-xs font-bold question-text">${c.val().text}</p>${c.val().answer?`<div class="mt-2 text-[10px] text-indigo-600 bg-indigo-50 p-2 rounded-lg">Ø§Ù„Ø±Ø¯: ${c.val().answer}</div>`:''}</div>`; });
});

function renderAdminInbox() {
    db.ref('tickets').on('value', snap => {
        const list = document.getElementById('admin-questions-list');
        list.innerHTML = "";

        const items = [];
        snap.forEach(c => {
            items.push({ key: c.key, ...c.val() });
        });

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ù‹Ø§
        items.reverse().forEach(c => {
            list.innerHTML += `
            <div class="bg-gray-50 p-3 rounded-xl border text-[10px] mb-2">
                <b>${c.name}</b>
                <p class="question-text">${c.text || ""}</p>

                ${c.answer ? `
                    <div class="mt-2 bg-green-50 text-green-700 p-2 rounded-lg">
                        <b>ØªÙ… Ø§Ù„Ø±Ø¯:</b> ${c.answer}
                    </div>
                ` : `
                    <textarea id="ans-${c.key}" class="w-full mt-2 border p-1 rounded"></textarea>
                    <button onclick="replyTicket('${c.key}','${c.uid}')" class="bg-indigo-600 text-white px-3 py-1 mt-1 rounded">
                        Ø±Ø¯ ÙˆØ¥Ø´Ø¹Ø§Ø±
                    </button>
                `}
            </div>`;
        });
    });
}
function replyTicket(id, uid) { const a = document.getElementById('ans-'+id).value; db.ref('tickets/'+id).update({answer:a, status:'ØªÙ… Ø§Ù„Ø±Ø¯'}).then(()=>db.ref('notifications/'+uid).push({msg:"Ù‚Ø§Ù… Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ", time:getFullDateTime(), read:false})); }

function renderEducation() {
    const g = document.getElementById('filter-grade').value, t = document.getElementById('filter-term').value, list = document.getElementById('edu-list');
    db.ref(eduType).on('value', snap => {
        list.innerHTML = ""; snap.forEach(c => { if(c.val().grade===g && c.val().term===t) list.innerHTML += `<div class="bg-white p-4 rounded-2xl border-r-4 border-indigo-600 flex justify-between items-center"><div><h4 class="font-bold text-sm">${c.val().title}</h4></div><button onclick="openContent('${eduType}','${c.key}')" class="bg-indigo-600 text-white px-5 py-1 rounded-lg text-xs">ÙØªØ­</button></div>`; });
    });
}

function openContent(type, id) { db.ref(`${type}/${id}`).once('value', s => { if(type==='quizzes') { activeQuizData = s.val(); startQuiz(s.val()); } else window.open(s.val().link, '_blank'); }); }

function startQuiz(quiz) {
    showPage('quiz-view'); document.getElementById('active-q-title').innerText = quiz.title;
    const container = document.getElementById('quiz-questions-container'); container.innerHTML = "";
    quiz.questions.forEach((q, i) => { container.innerHTML += `<div id="q-block-${i}"><p class="font-bold text-sm mb-2 question-text">${i+1}. ${q.text}</p>${q.img?`<img src="${q.img}" class="w-full rounded-xl mb-3 border">`:""}<div class="space-y-2">${q.options.map((o, oi) => `<button onclick="selectOption(${i},${oi},this)" class="option-btn">${o}</button>`).join('')}</div></div>`; });
}

function selectOption(qi, oi, btn) { userAnswers[qi] = oi; btn.parentElement.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); }

function finishQuiz() {
    let score = 0;
    activeQuizData.questions.forEach((q, i) => {
        const block = document.getElementById(`q-block-${i}`);
        block.querySelectorAll('.option-btn').forEach((b, bi) => { b.disabled = true; if(bi === q.correct) b.classList.add('correct'); else if(userAnswers[i] === bi) b.classList.add('wrong'); });
        if(userAnswers[i] === q.correct) score++;
    });
    const p = Math.round((score/activeQuizData.questions.length)*100);
    db.ref('results').push({ uid: currentUser.username, userName: currentUser.fullname, quizTitle: activeQuizData.title, score, total: activeQuizData.questions.length, percent: p, time: getFullDateTime() });
    document.getElementById('submit-quiz-btn').classList.add('hidden'); document.getElementById('quiz-result').classList.remove('hidden');
    document.getElementById('score-circle').innerText = `${score}/${activeQuizData.questions.length}`;
    activeQuizData.finalScore = score;
}

function renderAchievements() {
    db.ref('results').orderByChild('uid').equalTo(currentUser.username).on('value', snap => {
        const hist = document.getElementById('tests-history'); hist.innerHTML = "";
        let count = 0, total = 0;
        snap.forEach(c => { count++; total += c.val().percent; hist.innerHTML += `<div class="bg-white p-3 rounded-xl border flex justify-between text-[10px]"><span>${c.val().quizTitle}</span><span class="font-bold text-indigo-600">${c.val().percent}%</span></div>`; });
        document.getElementById('dash-tests-count').innerText = count; document.getElementById('dash-avg').innerText = count>0 ? Math.round(total/count)+"%" : "0%";
    });
}

function renderAdminResults() {
    db.ref('results').on('value', snap => {
        const list = document.getElementById('admin-results-list');
        list.innerHTML = "";

        const items = [];
        snap.forEach(c => {
            items.push(c.val());
        });

        // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
        items.reverse().forEach(r => {
            list.innerHTML += `
            <div class="p-2 border-b text-[10px] flex justify-between">
                <span><b>${r.userName}</b> - ${r.quizTitle}</span>
                <span>${r.percent}%</span>
            </div>`;
        });
    });
}

function addContent() {
    const t = document.getElementById('cont-type').value === 'video' ? 'videos' : 'books';
    db.ref(t).push({ title: document.getElementById('cont-title').value, link: document.getElementById('cont-link').value, grade: document.getElementById('cont-grade').value, term: document.getElementById('cont-term').value }).then(() => alert("ØªÙ…"));
}

function getFullDateTime() { return new Date().toLocaleDateString('ar-EG', { day: 'numeric', month: 'numeric', hour: '2-digit', minute: '2-digit' }); }
function publishPost() { const t = document.getElementById('post-input').value, i = document.getElementById('post-img').value; if(t) db.ref('posts').push({ text: t, img: i, likes: 0 }).then(() => sendGlobalNotif("ğŸ“¢ Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø³ØªØ§Ø°")); }
function addTopStudent() { db.ref('top_students').push({ name: document.getElementById('top-name').value, img: document.getElementById('top-img').value }); }
function addQuestionUI() {
    const div = document.createElement('div'); div.className = "p-4 bg-gray-50 rounded-2xl border relative";
    div.innerHTML = `<textarea placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„" class="w-full p-2 mb-2 text-xs border rounded-lg q-text"></textarea><input placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©" class="w-full p-2 mb-2 text-xs border rounded-lg q-img"><div class="grid grid-cols-2 gap-2"><input placeholder="Ø£" class="p-2 border rounded-lg text-xs opt-0"><input placeholder="Ø¨" class="p-2 border rounded-lg text-xs opt-1"><input placeholder="Ø¬" class="p-2 border rounded-lg text-xs opt-2"><input placeholder="Ø¯" class="p-2 border rounded-lg text-xs opt-3"></div><select class="w-full mt-2 p-2 text-xs border rounded-lg q-correct"><option value="0">Ø£</option><option value="1">Ø¨</option><option value="2">Ø¬</option><option value="3">Ø¯</option></select>`;
    document.getElementById('questions-builder').appendChild(div);
}
function saveQuiz() {
    const questions = [];
    document.querySelectorAll('#questions-builder > div').forEach(d => { questions.push({ text: d.querySelector('.q-text').value, img: d.querySelector('.q-img').value, options: [d.querySelector('.opt-0').value, d.querySelector('.opt-1').value, d.querySelector('.opt-2').value, d.querySelector('.opt-3').value], correct: parseInt(d.querySelector('.q-correct').value) }); });
    db.ref('quizzes').push({ title: document.getElementById('q-title').value, grade: document.getElementById('q-grade').value, term: document.getElementById('q-term').value, questions }).then(()=>alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"));
}
function shareResult() { const text = `Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${activeQuizData.finalScore} Ù…Ù† ${activeQuizData.questions.length} ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± (${activeQuizData.title}) Ù…Ø¹ Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª!`; window.open(`https://wa.me/?text=${encodeURIComponent(text)}`); }

db.ref('top_students').on('value', snap => {
    const list = document.getElementById('students-list'); list.innerHTML = "";
    snap.forEach(c => { list.innerHTML += `<div class="bg-white p-3 rounded-2xl text-center shadow border"><img src="${c.val().img||'https://cdn-icons-png.flaticon.com/512/194/194931.png'}" class="w-16 h-16 mx-auto mb-1 rounded-lg"><h4 class="text-[9px] font-bold">${c.val().name}</h4></div>`; });
});

db.ref("profile").on("value", snap => {
    if(!snap.exists()) return; const p = snap.val();
    document.getElementById("prof-name-disp").innerText = p.name;
    document.getElementById("prof-wa-link").href = "https://wa.me/" + p.wa;
    document.getElementById("prof-fb-link").href = p.fb;
    if(p.img) document.getElementById("profile-pic-disp").innerHTML = `<img src="${p.img}" class="w-full h-full object-cover">`;
});

db.ref('app_stats/install_count').on('value', s => { 
    const c = s.val()||0; 
    if(document.getElementById('install-count-public')) document.getElementById('install-count-public').innerText = c;
    if(document.getElementById('admin-install-count')) document.getElementById('admin-install-count').innerText = c;
});

let deferredPrompt;
window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; });
document.getElementById('install-btn').addEventListener('click', async () => {
    if(deferredPrompt) { deferredPrompt.prompt(); const {outcome} = await deferredPrompt.userChoice; if(outcome==='accepted') db.ref('app_stats/install_count').transaction(c=>(c||0)+1); deferredPrompt=null; }
    else { alert("Ù„Ù„ØªØ«Ø¨ÙŠØª: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø«Ù… Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"); db.ref('app_stats/install_count').transaction(c=>(c||0)+1); }
});

if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
</script>
</body>
</html>
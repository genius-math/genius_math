<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Genius Math</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }
.page { display: none; min-height: 100vh; }
.active-page { display: block; animation: slideUp 0.3s ease-out; }
@keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.nav-active { color: #4f46e5 !important; }
.nav-active i { transform: scale(1.2); transition: 0.3s; }
#chat-box::-webkit-scrollbar { width: 4px; }
#chat-box::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
</style>
</head>
<body class="pb-20">

<header class="bg-indigo-700 text-white p-4 text-center shadow-lg sticky top-0 z-50 rounded-b-2xl">
<h1 class="text-xl font-bold tracking-wide">Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h1>
<p class="text-[10px] opacity-80 uppercase tracking-tighter">Genius Math - Mr. Ahmad Elkholy</p>
</header>

<main class="p-4 max-w-md mx-auto">

<section id="posts" class="page active-page">
<div class="flex justify-between items-center mb-4">
<h2 class="font-bold text-gray-800"><i class="fas fa-stream ml-2 text-indigo-600"></i>Ø³Ø§Ø­Ø© Ø§Ù„ØªØ¹Ù„Ù…</h2>
<button onclick="unlockAdmin()" class="text-[10px] bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-bold shadow-sm">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
</div>

<div id="admin-panel" class="hidden bg-white p-4 rounded-2xl mb-6 border-2 border-indigo-500 shadow-xl overflow-hidden">
<h3 class="text-indigo-700 font-bold mb-3 text-sm flex items-center"><i class="fas fa-plus-circle ml-2"></i>Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
<textarea id="post-input" class="w-full border-none bg-gray-50 rounded-xl p-3 text-sm focus:ring-2 focus:ring-indigo-400 mb-3" rows="3" placeholder="Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ®Ø¨Ø± Ø·Ù„Ø§Ø¨Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ"></textarea>
<input id="post-img" type="text" class="w-full bg-gray-50 border-none rounded-xl p-3 text-sm mb-4" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
<button onclick="publishPost()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-indigo-200">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
</div>

<div id="posts-feed" class="space-y-6">
<div class="text-center py-10"><i class="fas fa-circle-notch animate-spin text-indigo-500 text-3xl"></i></div>
</div>
</section>

<section id="ai" class="page">
<div class="bg-white rounded-3xl shadow-xl border border-gray-100 flex flex-col h-[75vh]">
<div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4">
<div class="bg-indigo-50 p-4 rounded-2xl rounded-tr-none text-sm text-indigo-800 leading-relaxed shadow-sm">
Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ <b>Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ</b> Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ÙˆØ³Ø£Ø´Ø±Ø­Ù‡ Ù„Ùƒ ÙÙˆØ±Ø§Ù‹.
</div>
</div>
<div class="p-3 border-t bg-gray-50 rounded-b-3xl">
<div class="flex gap-2 bg-white p-2 rounded-2xl shadow-inner border">
<input id="ai-input" type="text" class="flex-1 bg-transparent px-3 text-sm outline-none" placeholder="Ø§ÙƒØªØ¨ Ù…Ø³Ø£Ù„ØªÙƒ Ù‡Ù†Ø§...">
<button onclick="callAI()" class="bg-indigo-600 text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-lg"><i class="fas fa-paper-plane"></i></button>
</div>
</div>
</div>
</section>

<section id="contact" class="page">
<div class="bg-white rounded-3xl p-8 shadow-xl text-center border border-gray-100">
<div class="relative w-24 h-24 mx-auto mb-6">
<div class="absolute inset-0 bg-indigo-500 rounded-full animate-ping opacity-20"></div>
<div class="relative bg-indigo-100 w-24 h-24 rounded-full flex items-center justify-center border-4 border-white shadow-lg">
<i class="fas fa-user-tie text-4xl text-indigo-600"></i>
</div>
</div>
<h2 class="text-2xl font-bold text-gray-800 mb-1">Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®ÙˆÙ„ÙŠ</h2>
<p class="text-indigo-600 text-sm font-medium mb-8 italic">Ø®Ø¨ÙŠØ± Ù…Ø§Ø¯Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</p>

<div class="space-y-4">
<a href="https://wa.me/201110490148" target="_blank" class="flex items-center justify-center gap-4 bg-green-500 text-white p-4 rounded-2xl font-bold hover:scale-105 transition shadow-lg shadow-green-100">
<i class="fab fa-whatsapp text-2xl"></i> ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
</a>
<a href="https://facebook.com/ahmadelkholy22" target="_blank" class="flex items-center justify-center gap-4 bg-blue-600 text-white p-4 rounded-2xl font-bold hover:scale-105 transition shadow-lg shadow-blue-100">
<i class="fab fa-facebook-f text-2xl"></i> ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ
</a>
</div>
</div>
</section>

</main>

<nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t border-gray-100 flex justify-around p-3 shadow-2xl z-50 rounded-t-3xl">
<button onclick="showPage('posts')" id="btn-posts" class="flex flex-col items-center text-gray-400 nav-btn nav-active">
<i class="fas fa-th-large text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</button>
<button onclick="showPage('ai')" id="btn-ai" class="flex flex-col items-center text-gray-400 nav-btn">
<i class="fas fa-brain text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø§Ù„Ø°ÙƒØ§Ø¡</span>
</button>
<button onclick="showPage('contact')" id="btn-contact" class="flex flex-col items-center text-gray-400 nav-btn">
<i class="fas fa-id-card text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø§Ù„Ø£Ø³ØªØ§Ø°</span>
</button>
</nav>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
const firebaseConfig = { databaseURL: "https://genius-math-44207-default-rtdb.firebaseio.com/" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let isAdmin = false;

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ù‚Ù„
function showPage(pageId) {
document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
document.getElementById(pageId).classList.add('active-page');
document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
document.getElementById('btn-' + pageId).classList.add('nav-active');
window.scrollTo(0, 0);
}

// Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
function unlockAdmin() {
if(prompt("Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ ÙŠØ§ Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯:") === "2025") {
isAdmin = true;
document.getElementById('admin-panel').classList.remove('hidden');
alert("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ….");
renderPosts();
}
}

// Ø§Ù„Ù†Ø´Ø± ÙÙŠ Firebase
function publishPost() {
const text = document.getElementById('post-input').value;
const img = document.getElementById('post-img').value;
if(!text) return;
db.ref('posts').push({
text: text,
img: img,
date: new Date().toLocaleString('ar-EG'),
likes: 0
});
document.getElementById('post-input').value = "";
document.getElementById('post-img').value = "";
}

// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
function renderPosts() {
db.ref('posts').on('value', (snapshot) => {
const feed = document.getElementById('posts-feed');
feed.innerHTML = "";
const data = snapshot.val();
if(!data) { feed.innerHTML = "<p class='text-center text-gray-400 py-10'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>"; return; }

Object.keys(data).reverse().forEach(key => {
const post = data[key];
let coms = "";
if(post.comments) Object.keys(post.comments).forEach(ckey => {
coms += `<div class="bg-gray-50 p-2 rounded-xl text-[11px] mb-1 flex justify-between items-center animate-fade-in">
<span>${post.comments[ckey].text}</span>
${isAdmin ? `<button onclick="deleteCom('${key}','${ckey}')" class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button>` : ""}
</div>`;
});

feed.innerHTML += `
<div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden post-card">
${post.img ? `<img src="${post.img}" class="w-full h-48 object-cover">` : ""}
<div class="p-5">
<div class="flex justify-between items-start mb-2">
<p class="text-gray-800 text-sm font-semibold leading-relaxed">${post.text}</p>
${isAdmin ? `<button onclick="deletePost('${key}')" class="text-red-500 text-xs"><i class="fas fa-trash-alt"></i></button>` : ""}
</div>
<span class="text-[9px] text-gray-400 font-bold">${post.date}</span>

<div class="mt-4 pt-4 border-t border-gray-50">
<div class="flex items-center text-xs text-indigo-600 font-bold mb-3">
<i class="far fa-comments ml-1"></i> Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
</div>
<div id="coms-list-${key}">${coms}</div>
<div class="flex gap-2 mt-3">
<input id="input-${key}" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ø§Ù‹..." class="flex-1 bg-gray-50 border-none rounded-xl px-3 py-2 text-[11px] outline-none focus:ring-1 focus:ring-indigo-300">
<button onclick="sendCom('${key}')" class="bg-indigo-600 text-white px-4 rounded-xl text-xs shadow-md"><i class="fas fa-paper-plane"></i></button>
</div>
</div>
</div>
</div>`;
});
});
}

function sendCom(key) {
const input = document.getElementById('input-'+key);
if(input.value.trim()) {
db.ref(`posts/${key}/comments`).push({ text: input.value });
input.value = "";
}
}

function deletePost(key) { if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) db.ref(`posts/${key}`).remove(); }
function deleteCom(pk, ck) { if(confirm("Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ")) db.ref(`posts/${pk}/comments/${ck}`).remove(); }

// Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
async function sendChat() {
  const input = document.getElementById("chatInput");
  const message = input.value.trim();
  if (!message) {
    alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„");
    return;
  }

  const chatBox = document.getElementById("chatBox");

  chatBox.innerHTML += `
    <div class="msg user">${message}</div>
  `;

  input.value = "";

  const loading = document.createElement("div");
  loading.className = "msg ai";
  loading.textContent = "ğŸ¤– Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...";
  chatBox.appendChild(loading);

  chatBox.scrollTop = chatBox.scrollHeight;

  try {
    const res = await fetch("/.netlify/functions/gemini", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    });

    const data = await res.json();
    loading.textContent = data.reply || "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯";

  } catch (err) {
    loading.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
  }

  chatBox.scrollTop = chatBox.scrollHeight;
}

renderPosts();
</script>
</body>
</html>
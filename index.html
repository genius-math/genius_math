<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Genius Math</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }
.page { display: none; min-height: 100vh; }
.active-page { display: block; }
.nav-active { color: #4f46e5 !important; }
</style>
</head>
<body class="pb-20">

<header class="bg-indigo-700 text-white p-4 text-center shadow-lg sticky top-0 z-50">
<h1 class="text-xl font-bold">Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h1>
<p class="text-xs opacity-80">Genius Math - Mr. Ahmad Elkholy</p>
</header>

<main class="p-4 max-w-md mx-auto">

<section id="visitor" class="page active-page">
<div class="bg-white p-6 rounded-2xl shadow">
<h2 class="font-bold mb-4">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø±</h2>
<input id="visitor-name" class="w-full p-3 bg-gray-100 rounded mb-3" placeholder="Ø§Ø³Ù…Ùƒ (ÙØ±ÙŠØ¯)">
<select id="visitor-avatar" class="w-full p-3 bg-gray-100 rounded mb-3">
<option value="ğŸ˜€">ğŸ˜€</option>
<option value="ğŸ˜">ğŸ˜</option>
<option value="ğŸ‘¨â€ğŸ“">ğŸ‘¨â€ğŸ“</option>
<option value="ğŸ‘©â€ğŸ“">ğŸ‘©â€ğŸ“</option>
<option value="â­">â­</option>
</select>
<button onclick="saveVisitor()" class="w-full bg-indigo-600 text-white py-3 rounded">Ø¯Ø®ÙˆÙ„</button>
</div>
</section>

<section id="posts" class="page">
<div id="posts-feed" class="space-y-4"></div>
</section>

<section id="ai" class="page">
<div class="bg-white rounded-xl shadow p-4 h-[70vh] flex flex-col">
<div id="chat-box" class="flex-1 overflow-y-auto mb-3"></div>
<div class="flex gap-2">
<input id="ai-input" class="flex-1 bg-gray-100 p-2 rounded" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ">
<button onclick="sendChat()" class="bg-indigo-600 text-white px-4 rounded">Ø¥Ø±Ø³Ø§Ù„</button>
</div>
</div>
</section>

<section id="contact" class="page">
<div class="bg-white p-6 rounded-xl shadow text-center">
<h2 id="teacher-name" class="font-bold text-lg"></h2>
<p id="teacher-exp" class="text-sm text-gray-500"></p>
</div>
</section>

</main>

<nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2">
<button onclick="showPage('posts')">ğŸ </button>
<button onclick="showPage('ai')">ğŸ¤–</button>
<button onclick="showPage('contact')">ğŸ‘¨â€ğŸ«</button>
</nav>

<script>
// Firebase
firebase.initializeApp({ databaseURL: "https://genius-math-44207-default-rtdb.firebaseio.com/" });
const db = firebase.database();

let visitor = JSON.parse(localStorage.getItem('visitor'));
if(visitor) showPage('posts');

function saveVisitor(){
const name = document.getElementById('visitor-name').value.trim();
const avatar = document.getElementById('visitor-avatar').value;
if(!name) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù…');
visitor = {name, avatar};
localStorage.setItem('visitor', JSON.stringify(visitor));
showPage('posts');
renderPosts();
}

function showPage(id){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active-page'));
document.getElementById(id).classList.add('active-page');
}

function renderPosts(){
db.ref('posts').on('value', snap=>{
const feed=document.getElementById('posts-feed');
feed.innerHTML='';
const data=snap.val()||{};
Object.keys(data).reverse().forEach(k=>{
const p=data[k];
feed.innerHTML+=`
<div class='bg-white p-4 rounded shadow'>
<p class='mb-2'>${p.text}</p>
<div class='flex gap-4 text-sm'>
<button onclick="reactPost('${k}','like')">ğŸ‘ ${p.likes||0}</button>
<button onclick="reactPost('${k}','dislike')">ğŸ‘ ${p.dislikes||0}</button>
</div>
<div class='mt-3'>
${Object.values(p.comments||{}).map(c=>`
<div class='text-xs bg-gray-100 p-2 rounded mb-1'>${c.avatar} <b>${c.name}</b>: ${c.text}</div>
`).join('')}
<input id='c-${k}' class='w-full bg-gray-100 p-2 rounded mt-2' placeholder='ØªØ¹Ù„ÙŠÙ‚Ùƒ'>
<button onclick="sendComment('${k}')" class='text-xs mt-1 text-indigo-600'>Ø¥Ø±Ø³Ø§Ù„</button>
</div>
</div>`;
});
});
}

function sendComment(k){
const i=document.getElementById('c-'+k);
if(!i.value) return;
db.ref(`posts/${k}/comments`).push({name:visitor.name,avatar:visitor.avatar,text:i.value});
i.value='';
}

function reactPost(k,t){
const r=db.ref(`posts/${k}/${t=='like'?'likes':'dislikes'}`);
r.transaction(v=>(v||0)+1);
}

async function sendChat(){
const input=document.getElementById('ai-input');
if(!input.value) return;
document.getElementById('chat-box').innerHTML+=`<div>${input.value}</div>`;
input.value='';
}

// profile
db.ref('profile').once('value').then(s=>{
const p=s.val()||{};
document.getElementById('teacher-name').innerText=p.name||'';
document.getElementById('teacher-exp').innerText=p.exp||'';
});

renderPosts();
</script>
</body>
</html>

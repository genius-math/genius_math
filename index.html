<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Genius Math</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }
.page { display: none; min-height: 100vh; }
.active-page { display: block; }
.nav-active { color: #4f46e5 !important; }
.avatar { width:32px;height:32px;border-radius:50%;object-fit:cover; }
</style>
</head>
<body class="pb-20"><header class="bg-indigo-700 text-white p-4 text-center shadow-lg sticky top-0 z-50">
<h1 class="text-xl font-bold">Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h1>
<p class="text-xs opacity-80">Genius Math - Mr. Ahmad Elkholy</p>
</header><main class="p-4 max-w-md mx-auto"><section id="visitor" class="page active-page">
<div class="bg-white p-6 rounded-2xl shadow">
<h2 class="font-bold mb-4">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø±</h2>
<input id="visitor-name" class="w-full p-3 bg-gray-100 rounded mb-3" placeholder="Ø§Ø³Ù…Ùƒ (ÙØ±ÙŠØ¯)">
<input id="visitor-avatar-file" type="file" accept="image/*" class="w-full p-3 bg-gray-100 rounded mb-3">
<img id="visitor-preview" class="avatar hidden mb-3">
<button onclick="saveVisitor()" class="w-full bg-indigo-600 text-white py-3 rounded">Ø¯Ø®ÙˆÙ„</button>
</div>
</section><section id="posts" class="page">
<div class="flex justify-between mb-3">
<select id="sort-comments" onchange="renderPosts()" class="bg-gray-100 p-2 rounded text-xs">
<option value="new">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
<option value="top">Ø§Ù„Ø£ÙƒØ«Ø± ØªÙØ§Ø¹Ù„Ù‹Ø§</option>
</select>
</div>
<div id="posts-feed" class="space-y-4"></div>
</section><section id="contact" class="page">
<div class="bg-white p-6 rounded-xl shadow text-center">
<img id="teacher-img" class="w-24 h-24 rounded-full mx-auto mb-3 hidden">
<h2 id="teacher-name" class="font-bold text-lg"></h2>
<p id="teacher-exp" class="text-sm text-gray-500"></p>
</div>
</section></main><nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2">
<button onclick="showPage('posts')">ğŸ </button>
<button onclick="showPage('contact')">ğŸ‘¨â€ğŸ«</button>
</nav><script>
firebase.initializeApp({ databaseURL: "https://genius-math-44207-default-rtdb.firebaseio.com/" });
const db = firebase.database();
const storage = firebase.storage();

let visitor = JSON.parse(localStorage.getItem('visitor'));
if(visitor) showPage('posts');

function saveVisitor(){
const name = visitorName.value.trim();
if(!name) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù…');
const file = visitorAvatarFile.files[0];
if(!file) return alert('Ø§Ø®ØªØ± ØµÙˆØ±Ø©');
const ref = storage.ref('avatars/'+Date.now()+'.jpg');
ref.put(file).then(()=>ref.getDownloadURL()).then(url=>{
visitor = {name, avatar:url, liked:{}};
localStorage.setItem('visitor', JSON.stringify(visitor));
showPage('posts');
renderPosts();
});
}

visitorAvatarFile.onchange = e =>{
visitorPreview.src = URL.createObjectURL(e.target.files[0]);
visitorPreview.classList.remove('hidden');
};

function showPage(id){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active-page'));
document.getElementById(id).classList.add('active-page');
}

function renderPosts(){
db.ref('posts').on('value', snap=>{
const feed = document.getElementById('posts-feed');
feed.innerHTML='';
const sort = document.getElementById('sort-comments').value;
let data = snap.val()||{};
Object.keys(data).reverse().forEach(k=>{
const p=data[k];
feed.innerHTML+=`
<div class='bg-white p-4 rounded shadow'>
<p>${p.text}</p>
<div class='flex gap-4 text-sm my-2'>
<button onclick="reactPost('${k}','like')">ğŸ‘ ${p.likes||0}</button>
<button onclick="reactPost('${k}','dislike')">ğŸ‘ ${p.dislikes||0}</button>
</div>
${Object.entries(p.comments||{}).sort((a,b)=> sort==='top' ? (b[1].likes||0)-(a[1].likes||0) : b[1].date-a[1].date ).map(([ck,c])=>`
<div class='flex items-center gap-2 text-xs bg-gray-100 p-2 rounded mb-1'>
<img src='${c.avatar}' class='avatar'>
<b>${c.name}</b>: ${c.text}
<button onclick="likeComment('${k}','${ck}')">ğŸ‘ ${c.likes||0}</button>
<button onclick="reportComment('${k}','${ck}')">ğŸš©</button>
</div>`).join('')}
<input id='c-${k}' class='w-full bg-gray-100 p-2 rounded mt-2' placeholder='ØªØ¹Ù„ÙŠÙ‚Ùƒ'>
<button onclick="sendComment('${k}')" class='text-xs mt-1 text-indigo-600'>Ø¥Ø±Ø³Ø§Ù„</button>
</div>`;
});
});
}

function sendComment(k){
const i=document.getElementById('c-'+k);
if(!i.value) return;
db.ref(`posts/${k}/comments`).push({name:visitor.name,avatar:visitor.avatar,text:i.value,likes:0,date:Date.now()});
i.value='';
}

function reactPost(k,t){
if(visitor.liked[k]) return alert('ØªÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¨Ø§Ù„ÙØ¹Ù„');
visitor.liked[k]=true;
localStorage.setItem('visitor',JSON.stringify(visitor));
const r=db.ref(`posts/${k}/${t=='like'?'likes':'dislikes'}`);
r.transaction(v=>(v||0)+1);
}

function likeComment(pk,ck){
const r=db.ref(`posts/${pk}/comments/${ck}/likes`);
r.transaction(v=>(v||0)+1);
}

function reportComment(pk,ck){
db.ref(`reports/${pk}/${ck}`).set({by:visitor.name,date:Date.now()});
alert('ØªÙ… Ø§Ù„ØªØ¨Ù„ÙŠØº');
}

// profile
db.ref('profile').once('value').then(s=>{
const p=s.val()||{};
teacherName.innerText=p.name||'';
teacherExp.innerText=p.exp||'';
if(p.img){ teacherImg.src=p.img; teacherImg.classList.remove('hidden'); }
});

renderPosts();
</script></body>
</html>

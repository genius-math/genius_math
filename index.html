<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Genius Math</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }
        .page { display: none; min-height: 100vh; }
        .active-page { display: block; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-active { color: #4f46e5 !important; }
        #chat-box::-webkit-scrollbar { width: 4px; }
        #chat-box::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="pb-20">

<header class="bg-indigo-700 text-white p-4 text-center shadow-lg sticky top-0 z-50 rounded-b-2xl">
    <h1 class="text-xl font-bold">Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h1>
    <p class="text-[10px] opacity-80 uppercase">Genius Math - Mr. Ahmad Elkholy</p>
</header>

<main class="p-4 max-w-md mx-auto">
    <section id="posts" class="page active-page">
        <div class="flex justify-between items-center mb-4">
            <h2 class="font-bold text-gray-800"><i class="fas fa-stream ml-2 text-indigo-600"></i>Ø³Ø§Ø­Ø© Ø§Ù„ØªØ¹Ù„Ù…</h2>
            <button onclick="unlockAdmin()" class="text-[10px] bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-bold">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        </div>

        <div id="admin-panel" class="hidden bg-white p-4 rounded-2xl mb-6 border-2 border-indigo-500 shadow-xl">
            <h3 class="text-indigo-700 font-bold mb-3 text-sm"><i class="fas fa-plus-circle ml-2"></i>Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
            <textarea id="post-input" class="w-full bg-gray-50 rounded-xl p-3 text-sm mb-3" rows="3" placeholder="Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ®Ø¨Ø± Ø·Ù„Ø§Ø¨ÙƒØŸ"></textarea>
            <input id="post-img" type="text" class="w-full bg-gray-50 rounded-xl p-3 text-sm mb-4" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¯Ø±Ø³ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <button onclick="publishPost()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
            
            <hr class="my-6">
            
            <h3 class="text-indigo-700 font-bold mb-3 text-sm"><i class="fas fa-user-edit ml-2"></i>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
            <input id="profile-name" type="text" class="w-full bg-gray-50 rounded-xl p-3 text-sm mb-2" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            <input id="profile-exp" type="text" class="w-full bg-gray-50 rounded-xl p-3 text-sm mb-2" placeholder="Ø§Ù„ÙˆØµÙ (Ù…Ø«Ù„Ø§Ù‹: Ø®Ø¨ÙŠØ± Ù…Ø§Ø¯Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª)">
            <input id="profile-img-url" type="text" class="w-full bg-gray-50 rounded-xl p-3 text-sm mb-2" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©">
            <input id="profile-wa" type="text" class="w-full bg-gray-50 rounded-xl p-3 text-sm mb-2" placeholder="Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨">
            <input id="profile-fb" type="text" class="w-full bg-gray-50 rounded-xl p-3 text-sm mb-4" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ³Ø¨ÙˆÙƒ">
            
            <div class="flex gap-3">
                <button onclick="saveProfile()" class="flex-1 bg-green-600 text-white py-3 rounded-xl font-bold">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                <button onclick="document.getElementById('admin-panel').classList.add('hidden')" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>

        <div id="posts-feed" class="space-y-6">
            <div class="text-center py-10"><i class="fas fa-circle-notch animate-spin text-indigo-500 text-3xl"></i></div>
        </div>
    </section>

    <section id="ai" class="page">
        <div class="bg-white rounded-3xl shadow-xl border flex flex-col h-[70vh]">
            <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4">
                <div class="bg-indigo-50 p-4 rounded-2xl rounded-tr-none text-sm text-indigo-800">
                    Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª.
                </div>
            </div>
            <div class="p-3 border-t bg-gray-50 rounded-b-3xl">
                <div class="flex gap-2 bg-white p-2 rounded-2xl shadow-inner border">
                    <input id="ai-input" type="text" class="flex-1 bg-transparent px-3 text-sm outline-none" placeholder="Ø§ÙƒØªØ¨ Ù…Ø³Ø£Ù„ØªÙƒ Ù‡Ù†Ø§...">
                    <button onclick="callAI()" class="bg-indigo-600 text-white w-10 h-10 rounded-xl flex items-center justify-center"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="page">
        <div class="bg-white rounded-3xl p-8 shadow-xl text-center border">
            <div id="profile-pic-container" class="relative w-24 h-24 mx-auto mb-6">
                <div class="bg-indigo-100 w-24 h-24 rounded-full flex items-center justify-center border-4 border-white shadow-lg">
                    <i class="fas fa-user-tie text-4xl text-indigo-600"></i>
                </div>
            </div>
            <h2 id="display-name" class="text-2xl font-bold text-gray-800 mb-1">Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®ÙˆÙ„ÙŠ</h2>
            <p id="display-exp" class="text-indigo-600 text-sm font-medium mb-8">Ø®Ø¨ÙŠØ± Ù…Ø§Ø¯Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</p>

            <div class="space-y-4">
                <a id="link-wa" href="#" target="_blank" class="flex items-center justify-center gap-4 bg-green-500 text-white p-4 rounded-2xl font-bold shadow-lg">
                    <i class="fab fa-whatsapp text-2xl"></i> ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                </a>
                <a id="link-fb" href="#" target="_blank" class="flex items-center justify-center gap-4 bg-blue-600 text-white p-4 rounded-2xl font-bold shadow-lg">
                    <i class="fab fa-facebook-f text-2xl"></i> ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ
                </a>
            </div>
        </div>
    </section>
</main>

<nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t flex justify-around p-3 shadow-2xl z-50 rounded-t-3xl">
    <button onclick="showPage('posts')" id="btn-posts" class="flex flex-col items-center text-gray-400 nav-active">
        <i class="fas fa-th-large text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </button>
    <button onclick="showPage('ai')" id="btn-ai" class="flex flex-col items-center text-gray-400">
        <i class="fas fa-brain text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø§Ù„Ø°ÙƒØ§Ø¡</span>
    </button>
    <button onclick="showPage('contact')" id="btn-contact" class="flex flex-col items-center text-gray-400">
        <i class="fas fa-id-card text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø§Ù„Ø£Ø³ØªØ§Ø°</span>
    </button>
</nav>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = { databaseURL: "https://genius-math-44207-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let isAdmin = false;
    let originalProfileData = null;

    // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById(pageId).classList.add('active-page');
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active', 'text-indigo-600'));
        document.getElementById('btn-' + pageId).classList.add('nav-active', 'text-indigo-600');
    }

    // Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    function unlockAdmin() {
        if(prompt("Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ ÙŠØ§ Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯:") === "2025") {
            isAdmin = true;
            document.getElementById('admin-panel').classList.remove('hidden');
            alert("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ….");
            loadProfileToForm();
        }
    }

    // Ø§Ù„Ù†Ø´Ø±
    function publishPost() {
        const text = document.getElementById('post-input').value;
        const img = document.getElementById('post-img').value;
        if(!text) return;
        db.ref('posts').push({
            text: text,
            img: img,
            date: new Date().toLocaleString('ar-EG'),
        }).then(() => {
            document.getElementById('post-input').value = "";
            document.getElementById('post-img').value = "";
        });
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
    db.ref('posts').on('value', (snapshot) => {
        const feed = document.getElementById('posts-feed');
        feed.innerHTML = "";
        const data = snapshot.val();
        if(!data) { feed.innerHTML = "<p class='text-center text-gray-400 py-10'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>"; return; }

        Object.keys(data).reverse().forEach(key => {
            const post = data[key];
            feed.innerHTML += `
            <div class="bg-white rounded-3xl shadow-sm border overflow-hidden">
                ${post.img ? `<img src="${post.img}" class="w-full h-48 object-cover">` : ""}
                <div class="p-5">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-gray-800 text-sm font-semibold">${post.text}</p>
                        ${isAdmin ? `<button onclick="deletePost('${key}')" class="text-red-500"><i class="fas fa-trash-alt"></i></button>` : ""}
                    </div>
                    <span class="text-[9px] text-gray-400">${post.date}</span>
                </div>
            </div>`;
        });
    });

    function deletePost(key) { if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±ØŸ")) db.ref(`posts/${key}`).remove(); }

    // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±)
    async function saveProfile() {
        const data = {
            name: document.getElementById("profile-name").value,
            exp: document.getElementById("profile-exp").value,
            img: document.getElementById("profile-img-url").value,
            wa: document.getElementById("profile-wa").value,
            fb: document.getElementById("profile-fb").value
        };
        await db.ref("profile").set(data);
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    db.ref("profile").on("value", (snap) => {
        if (!snap.exists()) return;
        const p = snap.val();
        originalProfileData = p;
        
        document.getElementById("display-name").innerText = p.name || "Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø§Ù„Ø®ÙˆÙ„ÙŠ";
        document.getElementById("display-exp").innerText = p.exp || "Ø®Ø¨ÙŠØ± Ù…Ø§Ø¯Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª";
        document.getElementById("link-wa").href = p.wa || "#";
        document.getElementById("link-fb").href = p.fb || "#";
        
        if (p.img) {
            document.getElementById("profile-pic-container").innerHTML = `
            <img src="${p.img}" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg">`;
        }
    });

    function loadProfileToForm() {
        if (!originalProfileData) return;
        document.getElementById("profile-name").value = originalProfileData.name || "";
        document.getElementById("profile-exp").value = originalProfileData.exp || "";
        document.getElementById("profile-img-url").value = originalProfileData.img || "";
        document.getElementById("profile-wa").value = originalProfileData.wa || "";
        document.getElementById("profile-fb").value = originalProfileData.fb || "";
    }

    // Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    async function callAI() {
        const input = document.getElementById("ai-input");
        const msg = input.value.trim();
        if(!msg) return;
        
        const box = document.getElementById("chat-box");
        box.innerHTML += `<div class="bg-white p-3 rounded-2xl shadow-sm self-end ml-10 border">${msg}</div>`;
        input.value = "";
        
        const loading = document.createElement("div");
        loading.className = "bg-indigo-50 p-3 rounded-2xl text-sm text-indigo-800";
        loading.innerText = "ğŸ¤– Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...";
        box.appendChild(loading);
        
        try {
            const res = await fetch("/.netlify/functions/gemini", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: msg })
            });
            const data = await res.json();
            loading.innerText = data.reply || "Ù„Ù… Ø£Ø³ØªØ·Ø¹ ÙÙ‡Ù… Ø§Ù„Ø³Ø¤Ø§Ù„";
        } catch(e) {
            loading.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
        }
        box.scrollTop = box.scrollHeight;
    }
</script>
</body>
</html>
